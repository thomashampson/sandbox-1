pipeline {
  agent none

  stages {
    stage('Build and Test') {
      matrix {
       agent {
         label "${PLATFORM}"
       }
       axes {
         axis {
           name 'PLATFORM'
           values 'linux-64'
         }
       }
       stages {   
         stage('One') {
           steps {
             checkout scm: [$class: 'GitSCM', branches: [[name: "${GIT_COMMIT}"]]]
             sh 'git rev-parse HEAD'
             sh 'cat jenkins/info.txt'
             input 'Proceed?'
           }
         }
         stage('Two') {
           steps {
            checkout scm: [$class: 'GitSCM', branches: [[name: "${GIT_COMMIT}"]]]
            sh 'git rev-parse HEAD'
            sh 'cat jenkins/info.txt'
           }
         }
       }
      }
    }
    stage('Package stuff') {
      matrix {
       agent {
         label "${PLATFORM}"
       }
       axes {
         axis {
           name 'PLATFORM'
           values 'linux-64'
         }
       }
       stages {   
         stage('Three') {
           steps {
             checkout scm: [$class: 'GitSCM', branches: [[name: "${GIT_COMMIT}"]]]
             sh 'git rev-parse HEAD'
             sh 'cat jenkins/info.txt'
           }
         }
         stage('Four') {
           steps {
            checkout scm: [$class: 'GitSCM', branches: [[name: "${GIT_COMMIT}"]]]
            sh 'git rev-parse HEAD'
            sh 'cat jenkins/info.txt'
           }
         }
       }
      }
    }
  }
}
